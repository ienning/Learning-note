# 面试汇总

## 镜头

1. 机器视觉中，常用的镜头接口有哪几种，有什么区别，分别有什么特点？

   答：接口是指镜头与相机之间的接口，C接口，CS接口，U接口，F接口，V接口，T2接口，M42，徕卡接口，M72接口等；接口类型的不同和镜头性能及质量并无直接关系，只是接口方式的不同，一般可以也可以找到各种常用接口之间的转接口

   - C接口和CS接口：工业相机最常见的国际标准接口，为1英寸-32UN英制螺纹连接口，C型接口和CS型接口的螺纹连接是一样的，区别在于C型接口的后截距为17.5mm，CS型接口的后截距为12.5mm。所以CS型接口的相机可以和C口以及CS口的镜头连接使用，只是使用C口镜头时需要加一个5mm的C-CS转接环；C型接口的相机不能用于CS口的镜头。
   - F接口镜头：尼康镜头的接口标准，所以又称尼康口，也是工业相机中常用的类型，一般相机靶面大于4/3英寸时需用F口的镜头
   - V接口镜头：著名的专业镜头平台耐德镜头所主要使用的标准，一般也是用于相机靶面较大或特殊用途的镜头
   - T接口镜头：拥有较长的后截距，因此可以通过换接口用在所有拍照的单反机身上，通用性极强。
   - 补充知识：
     - 后截距：镜头与摄像机接触面镜头焦平面（摄像机CCD光电感应器处的位置）的距离不同
     - 相机靶面：
     - 光学放大倍数：感光芯片尺寸(mm)/视场(mm) = 焦距f / 工作距离WD
     - 显示放大倍数：被测物体的显示放大倍率取决于三个因素：
       - 镜头光学倍率：
       - 工业相机感光芯片的尺寸（靶面大小）：像元尺寸\*相机分辨率
       - 显示器尺寸：

2.  我们通常说的2/3英寸，1英寸，1.1英寸镜头，这里面的英寸数是什么意思？

   答：英寸数指的是画面尺寸，能够提供最大感光面尺寸是多少英寸，也是通常所说的镜头成像圈所对应的感光靶规格。相机的感光面不能超出镜头表示的像面尺寸，否为会有暗角

3. 我们通常说的百万像素，二百万像素，五百万像素镜头，这里的像素数是指镜头的什么特性？

   答：是指镜头的空间分辨本领，因为镜头碧玺配合相机使用，为了方便记忆镜头和相机的匹配关系，人们通常用分辨率来命名镜头（错误的）。正确是：镜头和相机对应的并不是相机自身的像素分辨本领（像素数），而是极限空间分辨本领。***百万像素镜头与相机对应的极限空间分辨率90线对/mm（线对是一对黑白线），***二百万像素镜头对应的空间分辨本领是110线对/mm，五百万像素镜头对应的空间分辨本领是160线对/mm。，因此百万像素镜头配合相机的极限空间分辨本领必须低于90线对/mm，二百万像素镜头和五百万像素镜头配合相机的原理也相同，而***决定相机极限空间分辨率的并不是相机自身的像素分辨率，而是相机的单个像元尺寸大小。***

4. 微距镜头、远心镜头、鱼眼镜头各自有什么特点，各使用什么场景？

   答：

   - 微距镜头：微距镜头又称巨像镜头，是能够产生巨像效果的一种镜头。用于，
   - 远心镜头：是指在镜头物方、像方采取平行光路设计，单侧远心（物方和像方）主要用作显微镜放大，通常为2倍光学倍率以下，双侧远心（物方和像方同时远心）用于高精度成像，主要是为纠正传统工业镜头视差而设计，它可以在一定的物距范围内，使得到的图像***放大率不会变化***，这对被测物体不在统一物面上的情况是非常重要的应用。远心镜头犹豫其特有的平行光路设计，一直未对镜头畸变要求很高的视觉设计应用场景所青睐，远心镜头依据其独特的光学特征：高分辨率、超宽景深、超低畸变以及独有的平行光设计等，给机器视觉精密检测带来质的飞跃。
   - 鱼眼镜头：鱼眼镜头似乎是一种极端的超广角镜头，它利用镜头畸变获得极大的视角，视角在180度左右，因其巨大的视角类似鱼眼而名。

5. 什么是镜头的法兰距？

   答：后截距FB一般是指镜片组最后面的表面中心到焦距的距离，由镜头或光学系统最后一面到像面的距离为光学后截距。法兰距，即法兰焦距，是安装法兰到入射镜头平行光的汇聚点之间的距离。对镜头而言，法兰距是指镜头***无限远对焦***时镜头卡口平面到镜头理想平面之间的距离。

   - 对机身而言，法兰距是指卡口到焦平面（即CMOS所在的平面，感光元器件）之间的距离。
   - 如果把镜头想象成一个凸透镜，那么***对焦***就是通过移动透镜（即移动整个镜组）而使得一定距离的图像在焦平面上聚焦。

## 相机

1. 简述对三种相机接口GigE，USB3，CameraLink，IEEE1394的认识，各自有什么优缺点？使用GigE相机为什么一定要开启网卡巨帧？

   答：

   - CameraLink接口相机：能够解决大数据量传输问题，缺点可连接设备只能少（只能一台），点对点连接，LAN Link（Cat5 TP-RJ45）
     - 是一种串行通讯协议。采用LVDS接口标准，具有速度快、抗干扰能力强、功耗低。从Channel link技术上发展而来的，在Channel link技术基础上增加了一些传输控制信号，并定义了一些相关传输标准。协议采用MDR-26针连接器。高速率，带宽可达6400Mbps、抗干扰能力强、功耗低。一般用于高分辨率高速面阵相机，或者是线阵相机上。
     - 优点：
       - 高速，高像素深度，大图像尺寸
       - 容易配置相机属性
       - 可以确定性的触发和定时
       - 像机和图像采集设备之间可用标准线缆连接
     - 缺点：产品制作工艺复杂，成品较少，价格相对较贵，和并行数字相机相比使用图像采集卡时，有时需要另外安装软件。
       - 目前可用的产品较少
       - 与模拟，IEEE 1394和千兆以太网标准的相机相比，成本更高
       - 需要相机文件才能与National Instruments IMAQ图像采集设备一起使用
   - GigE接口相机：能够解决长距离，快速传输问题，可连接设备数量不受限：
     - 是一种基于千兆以太网通信协议开发的相机接口标准；适用于工业成像应用，通过网络传输无压缩视频信号；拓展性好，传输数据长度最长可伸展至100m（转播设备上可无限延长）；带宽达1Gbit，因此大量的数据可即时得到传输； 可使用标准的NIC卡（或PC上已默认安装）；经济性好，可使用廉价电缆（可使用通用的Ethernet电缆（CAT-6）和标准的连接器**；**可以很容易集成，且集成费用低**；**可管理维护性及广泛应用性。
     - 开启网卡巨帧的原因是：在大数据量传输下，会使CPU疲于应付数据包的中断，会造成丢包、延迟等现象的发生。所以设置网卡巨帧，可以支持一次性通过网络传输更大的数据包，这样数据包就不会这么容易中断了。
     - 优点：
       - 线缆连接简单
       - 与IEEE 1394相比，有更快的传输速率（高达1000 Mbps，取决于硬件）
       - 与并行标准和Camera Link标准相机相比，成本更低
       - 不需要相机文件
       - 可以部署到远程网络连接的位置
       - 不需要NI硬件
     - 缺点：以太网协议是基于包交换的，在CPU出于忙碌状态时，易造成数据的丢失。
       - 对所连接的计算机性能有一定要求
       - 必须优化主机侧的软件（安装特定的驱动程序）
       - 与CameraLink接口相机相比，GigE相机的耗电量较高
       - ~~缺少触发支持~~
       - ~~难以与其他设备同步~~
       - 需要设置IP，部份品牌工业相机对网卡芯片有要求，使用上没有1394、USB等接口方便
   - USB接口：支持热拔热插、使用便捷、标准统一、可连接多个设备、相机可通过USB线缆供电。但没有标准的协议、主从结构，CPU占用率高、带宽没有保证。usb3.0的接口一般都是可以自供电。但是也可以再接一个电源，假如usb接口供电不稳定的话，那么就可以选择外接电源来进行供电。USB3.0在USB 2.0的基础上新增了两组数据总线，速度有5Gbps
     - 优点：
       - 简单的连线
       - 即插即用功能
       - 高速，高像素深度，大图像尺寸
       - 不需要相机文件
       - 不需要NI硬件
     - 缺点
       - 触发支持取决于设备和软件定时
       - 难以与其他设备同步
   - 1394**接口相机：系统用到多个相机的时候可先择，要求高速的时候可先择。优点：不占系统CPU，帧频高； 缺点：占PCI插槽，价格昂贵。
     - 优点：
       - 连接简单
       - 与并行标准和Camera Link标准的相机相比，成本更低
       - 不需要相机文件
       - 支持多种帧速率和图像大小
       - 在单个帧接收器上支持多个相机
       - 提供适用于笔记本电脑的PCMCIA卡
       - 不需要NI硬件
     - 缺点
       - 数据传输速率较慢 - 1934a最高传输速率可达400 Mbps，1394b最高传输速率可达800 Mbps（传输速率取决于相机，IEEE 1394接口硬件和操作系统支持）
       - 没有用于保存图像的板载内存
       - 缺少触发支持
       - 难以与其他设备同步

2. 选用线扫相机时，主要从哪几个方面考虑？普通芯片线扫相机的行频跟曝光时间之间区别？TDI相机提高线扫行频的原理是什么？平场校正是什么，如何操作？

   答：

   - 如何选择线阵相机：

     1. 选择分辨率：幅宽除以最小检测精度得出每行需要的像素
     2. 检测精度：幅宽除以像素得出实际检测精度
     3. 扫描行数：每秒运动速度长度除以精度得出每秒扫描行数。
     4. 计算如下：
        - 如幅宽为1600 毫米、精度1 毫米、运动速度22000mm/s 相机：1600/1＝1600 像素 最少2000像素，选定为2k 相机 1600/2048＝0.8 实际精度22000mm/0.8mm＝27.5KHz 应选定相机为2048 像素28kHz 相机

   - 普通芯片线扫相机的行频和曝光时间之间的区别：

     - 曝光时间：
     - 曝光时间的增加，相机的行频就会下降，而且下降得很厉害
     - 在图像采集中，相机操作用两种常见的做法：“non-overlapped”的曝光和“overlapped”的曝光。在非重叠（“non-overlapped”）模式中，每个图像采集的周期中，相机在下一个图像采集开始前，均要完成曝光/读出整个过程
       - non-overlapped：允许在下一次图像开始曝光时候，将前面的曝光行值获取的图像数据读取并传递出去
       - overlapped：相机读出数据和下一次的曝光行值开始出现重叠的情况，同一时刻内，相机执行两个操作，导致相同时间单位内，在“overlapped”曝光模式下，可以采集到更多的图片，即是相机的行频高，但是曝光时间长了（物体发生移动，那么采集的图像就不是物体的真实所在位置的图像）容易产生拖影，曝光时间小了图像的亮度不佳，所以要挑选合适的曝光时间

   - TDI相机提高线扫行频的原理是：工作原理是，要求行扫速率与目标的运动速率严格同步，否则就不能正确的提取目标的图像信息。对同一目标多次曝光，通过延迟积分的方法，大大增加了光能的采集，与一般线阵CCD相比它具有响应度高、动态范围宽度等优点，它允许在限定光强时提高扫描速度，或在常速扫描时减小照明光源的亮度，减小了功耗，降低了成本。在光线较暗的场所也能输出一定信噪比的信号，可大大改善环境条件恶劣引起信噪比太低这一不利因素。

   - 平场校正是：

     - 理想情况下，当相机对均匀的目标成像时，得到的图像中所有像素点的灰度值理论上是相同的，然而实际图像中各像素的值往往会有较大差异，原因

       - 光照不均匀
       - 镜片中心和镜片边缘的响应不一致
       - 成像器件各像元响应不一致
       - 固定的图像背景噪音等

     - 所谓的平场校正就是校正传感器芯片上这些不一致

     - 平场校正就是通过调整每个像元响应的直线函数的斜率（即信号增益Gain）和偏移（即信号偏移量Offset）

     - 如何操作：

       1. 切换至相机校正模式：svm 1

       2. 根据最终使用情况设置相机校正环境（如行频、曝光时间、增益等）

       3. 确定平场目标（建议使用塑料、陶瓷或专业白平衡纸）

       4. 设置校正取样尺寸：css

       5. 暗场校正(FPN)：ccf

       6. 明场校正(PRNU)：ccp

       7. 保存设置与校正因子：wus + wpc.

       * 必须首先做暗场再做明场，因计算PRNU因子时要用到FPN因子的值。建议当环境温度变化高于10°C时，重新进行所有校正。

3. 卷帘曝光和全局曝光快门的区别？分别适用什么场景？

   答：

   - 卷帘曝光：又叫行曝光，卷帘快门、滚动快门
   - 全局曝光：又称帧曝光：
   - 区别：
   - 分别适用场景：
     - 机器视觉过程中必须保证图像清晰，防止拖影出现，全局曝光比较适合
     - 在运动物体图像采集过程中，必须考虑物体速度，速度大小严重影响图像采集效果；同时图像质量收拍摄视野大小影响较大，；
     - **线阵相机**由于传输量大，数据传输接口一般为GigE接口或CameraLink接口。卷帘曝光不适合拍摄运动的物体

4. 景深是什么意思？跟哪些因素相关？

   答：
   
   - 景深：当把物镜调焦到某一摄影对象时，在该对象的前后能在像面上呈清晰像的范围，
   - 和以下因素有关：
     - 镜头光圈：光圈越大，景深越小；光圈越小，景深越大
     - 镜头焦距：镜头焦距越长，景深越小；焦距越小，景深越大
     - 拍摄距离：距离越远，景深越大；距离越近，景深越小

## 光源

1. 氙气灯和LED灯各自有什么特点，各适用什么场景？

   答：

   - 氙气灯：亮，光色自然，寿命长，缺点：缺乏功能性（做不到灯光分区、矩阵大灯），启动速度慢（需要几秒后才能到达高亮度），耗电量大。除了光色（每年光衰比LED低）和穿透力有点优势，因为是惰性气体，内部需要高压，适合用于相机的专业闪光灯，最亮
     - 适合领域：精细加工的车间，适合实验室，手术室
   - LED灯：节能环保，寿命长，点亮速度快，体积小，方向性强

2. 简述什么叫明场、暗场、透视场照明，各适用什么场景？

   答：

   - 明场：光源与被测物体成一定角度，是的绝大部分的光反射到摄像机，称为明场
   - 暗场：光源位置使得大部分光没有反射到摄像机，仅仅将照射到被测物的特定部分反射到摄像机，，称为暗场照明
   - 透视场照明：相机和光源位于被检测物体两侧
   - 使用场景：
     - 明场：高角度环形光源，条形光源，全明场光源比较适用于检测反射性或相差很大的表面纹理和高度
     - 暗场：同轴光、环形光、条形光源，明场也有成像的劣势当被测物为高反射表面的无提示，例如金属、玻璃等，光打在检测表面会有高强度的反射光，成像时会产生大量的光点，暗场中相机捕获的是杂散光，没有反射光这么强烈，因此成像效果比明场理想，例如在显微镜下，放在两玻璃夹片中的物体，使用明场会影响被观测物体，所以暗场合适
     - 透视场照明：一般就是用于尺寸轮廓检测，如果使用正面照射，反射会造成虚影，损失像素，从而精度降低；
     - 环形光：一般用作定位、检测特定的缺陷，很难检测一个产品上有很多种缺陷时，环形光就显的比较局促了。
     - 同轴光：产品上缺陷比较多的时候，使用同轴光比较合适，例如，产品表面有发黄，油污，划伤（比较深的）等。缺点也很明显，就是光源在一定面积里有衰减，主要因为同轴光的发光原理时使用分光镜折射产生的，离光源较远的就比较暗，离光源较近的就比较亮；一般如果需要使用的话，按照我个人经验，选择比较大的同轴光，被检测物相对较小，可以选择比较均匀的位置检测

3. 什么场景下要使用频闪光源？如何实现光源与相机的同步频闪？（很基础的问题）

   答：当在快速移动的物体，拍摄会变得模糊，但是使用频闪可以解决快速移动的物体，用于增加光源亮度，如果频闪多次，多次定格清晰的运动对象，并在清晰对象之间形成拖尾的 虚影效果
   
   - 如何实现光源与相机的同步频闪
     - 答：根据机械确定的最大速度以确定相机的最小曝光时间，然后调整光源延时，让光源延时和曝光时间进行匹配，两者肯定不会相差过大

## 系统设计

1. 机器视觉项目中，图像样本是最重要的技术资料，如何管理样本，谈一谈你的看法

   答：样本从线上采集到，训练或测试，首先保证获取的样本，是机器视觉环境下能够一致的样本，存储的要本需要分类，保证样本是能够无偏见，无遗漏地覆盖各种实际应用中可能出现的情况。对高质量的真实样本进行符合应用 需求的精细标注。做到生产线上的流程和测试产生的大量样本，能够收集、存储、分析和报告所有样本，可以更快地发现根源问题，并可更加切实地解决问题

2. 机器视觉项目中，要保证成像效果的长期稳定，可以采取哪些措施？

   答：

   - 克服环境光干扰问题，保证图像稳定性
   - 选择合适光源：在能使用LED灯的情况下，使用LED灯，如无特殊要求而采用X射线等不可见光光源，对于可见光光源LED灯是最好的选择
   - 机械结构定位
   - 传感器类型、分辨率和帧率，
     - 摄像速度比较高（CMOS具有更快的读出速度），CCD传感器相机是保证图像质量和稳定性的首要选择，
     - 相机的分辨率和帧率主要根据检测精度和检测速度来选择，通过计算检测物体的现场大小与相机与被检测物之间的距离决定合适的分辨率，考虑被测物体的运动速度与检测精度要求选择相机的帧率。

3. 有以下场景：在流水线上检测一个产品，此产品的生产速度极快（一秒钟30件），相机需要检出残次品，并将残次品剔除。此情况下，如何保证剔除装置能够准确地动作？

   答：

   - 尽量采用并发式，一次能读取多个产品，对读取的产品进行找缺陷，然后确定好位置再到进行剔除，剔除装置尽量采用快速的装置（比如气动方式或者其他的）
   - 相机能够支持飞拍，使用频闪光源是一个好的选择

4. 如果检测对象是自发光的物体，例如红热状态的金属零件，要保证成像清晰，可以采集什么措施？

   答：使用偏正滤镜进行辅助，然后调整光圈使其变小，减少进光量，同时延长曝光时间，让非发光的部分成像清晰

5. 现场安装空间非常有限，没有足够的物距空间，可以尝试哪些措施？

   答：通过反光镜进行一定的距离的反射，相机再捕获图像，加接圈，
   
   - 使用近摄透镜，获取更近距离的像，减少20%
   
   - 工业缩放镜头，可以调整相机系统的视场，不行也要改变工作距离
   - 镜头隔离器，缩短工作距离、减少镜头的可视范围。缺点是带来扭曲同时降低解析度


